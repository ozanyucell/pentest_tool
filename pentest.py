#!/usr/bin/env python3

import subprocess as sp
import re

ipv4 = '[1-9][0-9]{0,2}\.[1-9][0-9]{0,2}\.[1-9][0-9]{0,2}\.[1-9][0-9]{0,2}'
port = '[1-9][0-9]{0,5}\/[a-zA-Z]{1,5}'

# nmap usage: https://www.vjsecurity.net/2021/09/what-is-nmap-uses-and-functions-of-nmap.html

def icmp_ping():
    print('Scanning with nmap...')
    result = sp.getoutput('nmap -sn 192.168.1.1-254')
    print()
    print('Scan is done.')
    ip_addresses = re.findall(f"{ipv4}", result)
    
    with open(f"./icmp.dat", mode="w", encoding="utf-8") as file:
        for ip in ip_addresses:
            file.write(ip + "\n")

def port_identification():
    with open(f"./icmp.dat", mode="r", encoding="utf-8") as file:
        ip_text = file.read()
        ip_addresses = ip_text.split("\n")

    live_hosts = []
    for ip in ip_addresses:
        ip_check = sp.getoutput(f"nmap -Pn {ip}")
        if (re.search("0 hosts up", ip_check)):
            continue
        live_hosts.append(ip)

    for ip in live_hosts:
        ports = sp.getoutput(f"nmap -Pn {ip}")
        for line in ports.splitlines():
            if (re.search(f"{port}", line)):
                with open(f"./ports.dat", mode="w", encoding="utf-8") as file:
                    file.write(ip + " " + line.split()[0] + " " +  line.split()[2])

def open_port_identification():
    return 0

def os_fingerprint_idetification():
    # https://nmap.org/book/osdetect-usage.html
    # https://www.geeksforgeeks.org/os-detection-in-nmap-in-kali-linux/
    os = sp.getoutput("nmap -sS 192.168.1.1 -O")

def router_firewall_identification():
    return 0

def web_server_detection():
    return 0

def snmp_detection():
    return 0

def syn_flood():
    return 0

def show():
    return 0
    
def sniff():
    return 0

def main(): # main function
        print("Welcome.")
        print("-"*50)
        print("1. ICMP Ping")
        print("2. Port Identification")
        print("3. Open Port Identification")
        print("4. OS Fingerprint Identification")
        print("5. Router & Firewall Detection")
        print("6. Web Server Detection")
        print("7. SNMP Detection")
        print("8. SYN_flood")
        print("9. Show")
        print("10. Sniff")
        print("11. Exit")
        print("-"*50)
        choice = input()

        if (choice==1):
            icmp_ping()
        elif (choice==2):
            port_identification()
        elif (choice==3):
            open_port_identification()
        elif (choice==4):
            os_fingerprint_idetification()
        elif (choice==5):
            router_firewall_identification()
        elif (choice==6):
            web_server_detection()
        elif (choice==7):
            snmp_detection()
        elif (choice==8):
            syn_flood()
        elif (choice==9):
            show()
        elif (choice==10):
            sniff()
        elif (choice==11):
            exit()
        else:
            print("Please enter a valid option.")

if __name__ == "__main__":
    main()
