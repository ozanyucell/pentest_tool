from scapy.all import *

command = input()

command = command.split()

if (command[0]!="sniff" and command[0]!="syn_flood"):
    print(f"Command '{command[0]}' not found.")
    # continue

# CHECK command[0] IS sniff or SYN_Flood HERE!

command.remove(command[0])

if(len(command) != 0 and str(command[0]).startswith("-")):
    options=list(str(command[0]))
    options.remove("-")
    args = command[1:]

    protocol_options=[]
    if 'T' in options:
        protocol_options.append("T")
        options.remove("T")
    if 'U' in options:
        protocol_options.append("U")
        options.remove("U")
    if 'I' in options:
        protocol_options.append("I")
        options.remove("I")
    #print("Options: " + str(options))
    #print("Protocol options: " + str(protocol_options))
    #print("Arguments: " + str(args))

    op_arg = {}

    if(len(args)!=len(options)):
        print("Missing arguments for amount of options that you have entered.")
        # return 0
    
    for i in range(len(args)):
        op_arg[options[i]]=args[i]
    # print("Options for arguments: " + str(op_arg))

    fltr=""

    if("s" in options):
        if(fltr==""):
            fltr = fltr + "src " + op_arg["s"]
        else:
            fltr = fltr + " and " + "src " + op_arg["s"]

    if("d" in options):
        if(fltr==""):
            fltr = fltr + "dst " + op_arg["d"] + " "
        else:
            fltr = fltr + " and " + "dst " + op_arg["s"]

    if("p" in options):
        if(fltr==""):
            fltr = fltr + "port " + op_arg["p"] 
        else:
            fltr = fltr + " and " + "port " + op_arg["s"] 

    if(protocol_options!=[]):
        if 'T' in protocol_options:
            if(fltr==""):
                fltr = fltr + "tcp"
            else:
                fltr = fltr + " and " + "tcp"
        if 'U' in protocol_options:
            if(fltr==""):
                fltr = fltr + "udp"
            else:
                fltr = fltr + " and " + "udp"
        if 'I' in protocol_options:
            if(fltr==""):
                fltr = fltr + "icmp"
            else:
                fltr = fltr + " and " + "icmp"

    if(fltr==""):
        if("c" in options):
            capture = sniff(count=int(op_arg["c"]))
            capture.summary()   
        else:
            capture = sniff()
            capture.summary()

    else:
        if("c" in options):
            capture = sniff(count=int(op_arg["c"]), filter=fltr)
            capture.summary()
        
        else:
            capture = sniff(filter=fltr)
            capture.summary()

else:
    print("Please enter a valid option.")
